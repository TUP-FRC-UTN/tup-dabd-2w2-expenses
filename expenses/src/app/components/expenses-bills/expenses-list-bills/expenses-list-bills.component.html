<app-main-container title="Listado de gastos">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <!-- Sección de búsqueda y filtros -->
    <div class="btn-group me-5" role="group">
      <div class="col-sm-12 col-md-8 col-xl-8">
        <div class="input-group">
          <span class="input-group-text" id="search-icon">
            <i class="bi bi-search"></i>
          </span>
          <input type="text" class="form-control" id="filter-text-box" [(ngModel)]="searchTerm"
            placeholder="Buscar..." />
          <app-table-filters [filters]="filterConfig" (filterValueChange)="filterChange($event)"></app-table-filters>
        </div>
      </div>
    </div>

    <!-- Botones de Activo, Inactivo, Todo y "+" en el mismo grupo -->
    <div class="d-flex align-items-center">
      <!-- Botón "+" -->
      <button type="button" class="btn btn-outline-primary" (click)="nuevoGasto()">+</button>

      <!-- Línea vertical y botones de exportación -->
      <div class="vertical-line mx-3"></div>
      <button class="btn btn-success me-2" (click)="downloadTable()">
        <i class="bi bi-file-earmark-excel"></i>
      </button>
      <button class="btn btn-danger me-2" (click)="imprimir()">
        <i class="bi bi-file-earmark-pdf"></i>
      </button>
    </div>
  </div>
</app-main-container>



<div class="card">
  <table class="table table-striped" id="table-data">
    <thead>
      <tr>
        <th scope="col">Tipo</th>
        <th scope="col">Proveedor</th>
        <th scope="col">Monto</th>
        <th scope="col">Periodo</th>
        <th scope="col">Categoria</th>
        <th scope="col">Fecha</th>
        <th scope="col">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let bill of bills | filterBy: ['amount', 'supplier.name', 'billType.name', 'category.name']: searchTerm | orderBy: ['date', 'category.name', 'supplier.name']; track $index">
        <td>{{ bill.billType.name }}</td>
        <td>{{ bill.supplier.name }}</td>
        <td>{{ bill.amount | currency: 'ARS' }}</td>
        <td>{{ bill.period.month }}/{{ bill.period.year }}</td>
        <td>{{ bill.category.name }}</td>
        <td>{{ bill.date | date: 'MMM d, yyyy' }}</td>
        <td>
          <button class="btn btn-sm btn-warning me-2" (click)="editBill(bill)">
            <i class="bi bi-pencil"></i>
          </button>
          <button class="btn btn-sm btn-primary">
            <i class="bi bi-eye"></i>
          </button>
        </td>
      </tr>
      <tr *ngIf="bills.length === 0">
        <td colspan="7" class="text-center">
          <div class="alert alert-secondary">No hay gastos para mostrar</div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<br>
<div class="row d-flex align-items-end">
  <div class="col">
    <nav aria-label="Page navigation example">
      <ul class="pagination justify-content-end" style="margin-bottom: 0;">

        <li class="page-item" [class.disabled]="currentPage === 0">
          <a class="page-link" (click)="onPageChange(currentPage - 1)" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
          </a>
        </li>


        <li class="page-item" *ngFor="let page of visiblePages" [class.active]="page === currentPage">
          @for(page of visiblePages;track $index){
          <a class="page-link" (click)="onPageChange(page)">{{ page + 1 }}</a>
          }

        </li>


        <li class="page-item" [class.disabled]="currentPage === totalPages - 1">
          <a class="page-link" (click)="onPageChange(currentPage + 1)" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>

</div>


<div class="row align-items-center mt-3">
  <div class="col-auto">
    <select class="form-select" [(ngModel)]="pageSize" (ngModelChange)="updatePageSize()">
      <option value="10">10</option>
      <option value="25">25</option>
      <option value="50">50</option>
    </select>
  </div>
  <div class="col">
    <ngb-pagination [(page)]="currentPage" [pageSize]="pageSize" [collectionSize]="totalElements" 
      (pageChange)="onPageChange($event)" [maxSize]="5" [boundaryLinks]="false" class="d-flex justify-content-end mb-0">
    </ngb-pagination>
  </div>
  <div class="col-auto d-flex justify-content-end">
    <button class="btn btn-secondary" (click)="showInfo()">
      <i class="bi bi-info-circle"></i>
    </button>
  </div>
</div>
