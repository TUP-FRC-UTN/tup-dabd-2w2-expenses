<app-main-container
  title="Lista de Periodos"
  (infoButtonClick)="showModal(modalTemplateInfo)"
>
  <div class="d-flex justify-content-between align-items-center mb-3">
    <!-- Sección de búsqueda y filtros -->
    <div class="row col-12" role="group">
      <div class="col-3">
        <div class="input-group">
          <div class="input-group">
            <input
              type="text"
              class="form-control"
              id="filter-text-box"
              placeholder="Buscar..."
              [(ngModel)]="searchTerm"
            />
            <span class="input-group-text" id="search-icon">
              <i class="bi bi-search"></i>
            </span>
            <app-table-filters
              [filters]="filterConfig"
              (filterValueChange)="filterChange($event)"
              
            ></app-table-filters>
          </div>
        </div>
      </div>

      <!-- Botones de Activo, Inactivo, Todo y "+" en el mismo grupo -->
      <div class="d-flex col-9 justify-content-end">
        <!-- Botón "+" -->
        <button
          type="button"
          class="btn btn-outline-primary"
          (click)="newPeriod()"
        >
          +
        </button>

        <!-- Línea vertical y botones de exportación -->
        <div class="vertical-line mx-3"></div>
        <button class="btn btn-success me-2" (click)="downloadTable()">
          <i class="bi bi-file-earmark-excel"></i>
        </button>
        <button class="btn btn-danger me-2" (click)="imprimir()">
          <i class="bi bi-file-earmark-pdf"></i>
        </button>
      </div>
    </div>
  </div>

  <div class="">

    <table
      class="table table-striped fixed-table"
      style="
        border: 1px solid rgba(0, 0, 0, 0.15);
        border-collapse: collapse;
        margin-top: 10px;
      "
    >
      <thead>
        <tr>
          <th scope="col">Fecha</th>
          <th scope="col" style="text-align: end">Total Extraordinarias</th>
          <th scope="col" style="text-align: end">Total Ordinarias</th>
          <th scope="col">Estado</th>
          <th scope="col" style="text-align: center">Acciones</th>
        </tr>
      </thead>
      <tbody>
        @if (listPeriod?.length ===0) {
        <tr>
          <td
            class="alert alert-secondary"
            role="alert"
            colspan="5"
            style="width: 100%; text-align: center"
          >
            No hay elementos para mostrar
          </td>
        </tr>

        } @else { @for (period of listPeriod | filterBy : ['month', 'year',
        'ordinary.amount', 'extraordinary.amount', 'state'] : searchTerm; track
        $index) {
        <tr>
          <td>{{ period.month }} / {{ period.year }}</td>
          <td style="text-align: end">
            {{
              period.extraordinary?.amount?.toLocaleString("es-AR", {
                style: "currency",
                currency: "ARS",
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
              })
            }}
          </td>
          <td style="text-align: end">
            {{
              period.ordinary?.amount?.toLocaleString("es-AR", {
                style: "currency",
                currency: "ARS",
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
              })
            }}
          </td>
          <td>
            <app-expenses-state-period-style
              [estado]="period.state"
            ></app-expenses-state-period-style>
          </td>
          <td
            style="
              display: flex;
              flex-direction: row;
              gap: 2px;
              justify-content: center;
            "
          >
            <div class="btn-group" role="group">
              <button
                type="button"
                class="btn btn-sm btn-secondary dropdown-toggle"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="bi bi-three-dots-vertical"></i>
              </button>
              <ul class="dropdown-menu">
                <li>
                  <a
                    class="dropdown-item btn btn-primary"
                    [href]="'/periodo/' + period.id + '/expensas'"
                    >Expensas</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item btn btn-info"
                    [href]="'/periodo/' + period.id + '/liquidacion'"
                    >Liquidacion</a
                  >
                </li>
                @if (period.state!=="CLOSE") {
                <li>
                  <a
                    class="dropdown-item btn btn-danger"
                    data-bs-target="#exampleModal"
                    data-bs-toggle="modal"
                    (click)="open(modalTemplate, period.id)"
                    >Cerrar</a
                  >
                </li>
                }
                <li><a class="dropdown-item btn btn-primary">Detalle</a></li>
              </ul>
            </div>
          </td>
        </tr>
        } }
      </tbody>
    </table>
    <div class="row d-flex align-items-between">
      <div class="col-1">
        <select
          name="tipoExpensa"
          id="tipoExpensa"
          class="form-select"
          aria-label="Default select example"
          (change)="onSelectChange($event)"
        >
          <option value="10">10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <div
        class="col-11"
        style="display: flex; flex-direction: row; justify-content: end"
      >
        <ngb-pagination
          [(page)]="currentPage"
          [pageSize]="size"
          [collectionSize]="cantPages.length"
          (pageChange)="changeIndex($event)"
          [maxSize]="5"
          [boundaryLinks]="false"
        ></ngb-pagination>
      </div>
    </div>
    
  </div>
  <ng-template #modalTemplate let-modal>
    <app-expenses-modal
      [title]="'Cierre de Periodo'"
      [paragraph]="
        '¿Desea cerrar el periodo?. Recuerde que una vez concluido el cierre del periodo no podra agregar, modificar o eliminar gastos o periodos.'
      "
      (onAccept)="closePeriod()"
      (onCancel)="modal.dismiss('cancel')"
    ></app-expenses-modal>
  </ng-template>

  <ng-template #modalTemplateInfo let-modal>
    <app-info-modal
      [title]="'Acerca de Periodos'"
      [body]="
        'Se muestra una lista con todos los periodos, con su estado y sus montos de liquidaciones de expensas tanto ordinarias como extraordinarias. Puede filtrarse tanto por sus estados abiertos o cerrados como por su mes o año'
      "
      (onAccept)="modal.dismiss('cancel')"
    ></app-info-modal>
  </ng-template>
</app-main-container>
