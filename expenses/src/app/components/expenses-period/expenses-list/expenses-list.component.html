<div class="container" style="margin-top: 18px;">
    <div class="row" style="align-items:end" >

      <div class="position-relative" style="padding-bottom: 20px">
        <div class="row">
          <div class="col">
            <h1>Listado de expensas</h1>

          </div>
          <div  class="col d-flex gap-1 justify-content-end" style="align-items: end">
            <button class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#infoModal">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
              </svg>
            </button>
          </div>

       </div>

      </div>
      <div class="btn-group me-2" style="padding-bottom: 15px">
      <div class="input-group w-25">
           <span class="input-group-text">
             <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                 <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
             </svg>
        </span>
        <input
          type="text"
          class="form-control"
          placeholder="Buscar expensa..."
          [(ngModel)]="searchTerm">
        <div class="col-auto">
            <button type="button" class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#filterModal">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-funnel-fill" viewBox="0 0 16 16">
                <path d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5z"/>
              </svg><svg xmlns="http://www.w3.org/2000/svg" width="10" height="16" fill="currentColor" class="bi bi-caret-down-fill" viewBox="0 0 16 16">
              <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
            </svg>
            </button>
        </div>
      </div>
        <div class="col d-flex gap-1 justify-content-end">
          <div class="col-auto">
            <button class="btn" (click)="downloadTable()" style="background-color: #239b56  ; color: white;" data-toggle="tooltip" data-placement="bottom" title="Descargar expensas como excel">
              <i class="bi bi-file-earmark-excel"></i><!-- Icono de excel -->
            </button>
          </div>
          <div class="col-auto">
            <button class="btn" (click)="imprimir()" style="background-color: red; color: white;" data-toggle="tooltip" data-placement="top" title="Descargar expensas como pdf">
              <i class="bi bi-file-pdf"></i> <!-- Icono de pdf -->
            </button>
          </div>
        </div>
      </div>
      </div>


<!-- Modal con los selectores -->
<div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
  <div class="modal-dialog" style=" z-index: 1040;">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="filterModalLabel">Filtrar por:</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Selectores dentro del modal -->

        <div class="row">
          <div class="col-12 mb-3 d-flex align-items-center">
            <label for="periodo" class="me-2" style="width: 100px;">Periodo</label>
            <select name="periodo" id="periodo" class="form-select" style="flex: 1;" aria-label="Default select example" [(ngModel)]="selectedPeriodId">
              <option [value]="0">Todos</option>
              @for (period of periodos | orderBy: ['year']; track $index) {
                <option [value]="period.id">{{period.month}} / {{period.year}}</option>
              }
            </select>
          </div>

          <div class="col-12 mb-3 d-flex align-items-center">
            <label for="lote" class="me-2" style="width: 100px;">Lote</label>
            <select name="lote" id="lote" class="form-select" style="flex: 1;" aria-label="Default select example" [(ngModel)]="selectedLotId">
              <option [value]="0">Todos</option>
              @for (lot of lots | orderBy: ['plot_number']; track $index) {
                <option [value]="lot.id">{{lot.plot_number}}</option>
              }
            </select>
          </div>

          <div class="col-12 mb-3 d-flex align-items-center">
            <label for="tipoExpensa" class="me-2" style="width: 100px;">Tipo de expensa</label>
            <select name="tipoExpensa" id="tipoExpensa" class="form-select" style="flex: 1;" aria-label="Default select example" [(ngModel)]="selectedTypeId">
              <option [value]="0">Todas</option>
              @for (tipo of tipos | orderBy: ['name']; track $index) {
                <option [value]="tipo.bill_type_id">{{tipo.name}}</option>
              }
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-danger" (click)="clearFilters()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash-fill" viewBox="0 0 16 16">
              <path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5M8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5m3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0"/>
            </svg>
          </button>
         <!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>-->
          <button type="button" class="btn btn-outline-primary" (click)="applyFilters()" data-bs-dismiss="modal"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
          </svg></button>
        </div>

      </div>
    </div>
  </div>
</div>

    <div class="card" style="padding-top: 5px">
      <div style="height: 500px; overflow-y: auto;">
      <table class="table table-striped" id="table-data">
        <thead class="justify-content-end">
          <tr>
            <th scope="col" style="text-align: center">Número de Lote</th>
            <th scope="col">Tipo de lote</th>
            <th scope="col">Periodo</th>
            <th scope="col">Porcentaje</th>
            <th scope="col">Tipo de expensa</th>
            <th scope="col">Fecha de liquidación</th>
            <th scope="col" style="text-align: right">Monto Total</th>

          </tr>
        </thead>
        <tbody>

          @for (expense of expenses | filterBy: ['lotId', 'month','totalAmount','liquidationDate','state','plotNumber','typePlot','percentage','billType']: searchTerm; track $index) {
            <tr>
                <td style="text-align: center">{{expense.plotNumber}} </td>
                <td>{{expense.typePlot}}</td>
                <td>{{expense.month }}-{{ expense.period.year }} </td>
                <td>{{expense.percentage  * 100 + '%'}}</td>
                <td>{{expense.billType}}</td>
                <td>{{expense.liquidationDate | date:'MMM d, yyyy'}}</td>
              <td style="text-align:  right">{{expense.totalAmount.toLocaleString("es-AR", {
                style: "currency",
                currency: "ARS",
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
              }) }}</td>
            </tr>
          }@empty {
            <td colspan="7" class="text-center">
              <div class="text-center p-3">
                <div class="alert alert-secondary">
                  No hay expensas para mostrar
                </div>
              </div>
            </td>}

        </tbody>
      </table>
    </div>
  </div>

    <br>
    <div class="row align-items-end">
      <div class="col-2 d-flex justify-content-start">
        <select name="cantidadPaginas" id="cantidadPaginas" class="form-select" aria-label="Cantidad de elementos por página" [(ngModel)]="pageSize" (ngModelChange)="onPageSizeChange()">
          <option value="10">10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>


        <div class="col d-flex justify-content-end align-items-center">
          <nav aria-label="Page navigation example">
            <ul class="pagination mb-0">
              <!-- Botón de página anterior -->
              <li class="page-item" [class.disabled]="currentPage === 0">
                <a class="page-link" (click)="onPageChange(currentPage - 1)" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>

              <!-- Páginas visibles limitadas -->
              <li class="page-item" *ngFor="let page of visiblePages" [class.active]="page === currentPage">
                <a class="page-link" (click)="onPageChange(page)">{{ page + 1 }}</a>
              </li>

              <!-- Botón de página siguiente -->
              <li class="page-item" [class.disabled]="currentPage === totalPages - 1">
                <a class="page-link" (click)="onPageChange(currentPage + 1)" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
      <div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="infoModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="infoModalLabel">Información</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              Esto es una prueba
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
          </div>
        </div>
      </div>
  </div>
